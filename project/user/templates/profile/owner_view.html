{% extends "layout.html" %}
{% block title %}{{ current_user.user.name }} {{ current_user.user.surname }}{% endblock %}
{% block content %}
    <div>
        <img src="{{ current_user.profile_pic }}" alt="profile pic" width="45rem" height="45rem">
        <input type="text" value="{{ current_user.user.name }} {{ current_user.user.surname }}" class="form-control" disabled>
        {% block edit_email %}
            <input type="email" value="{{ current_user.user.email }}" class="form-control" disabled>
            <a href="{{ url_for('usuario.update_email') }}">Atualizar email</a>
        {% endblock %}
    </div>

    <form action="{{ url_for('perfil.select_supervisor') }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="supervisorDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Escolher supervisor
        </button>
        <ul class="dropdown-menu" aria-labelledby="supervisorDropdown">
            {% for friend in current_user.friends %}
                <li>
                    <a class="dropdown-item d-flex align-items-center" href="#" onclick="selectSupervisor('{{ friend
                    .id }}', '{{ friend.user.name }} {{ friend.user.surname }}'); return false;">
                        <img src="{{ friend.profile_pic }}" alt="#" class="me-2 rounded-circle" style="width: 30px; height: 30px;">
                        {{ friend.user.name }} {{ friend.user.surname }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        <input type="hidden" name="supervisor_id" id="supervisorInput">

        <p class="mt-2">Selecionado: <span id="selectedSupervisor">
            {% if current_user.supervisor %}
            	{{ current_user.supervisor.user.name }} {{ current_user.supervisor.user.surname }}
            {% else %}
                Nenhum
            {% endif %}
        </span></p>

        <input type="submit" value="Salvar" class="btn btn-primary mt-2">
        </div>
    </form>

    <div>
        <a href="#">Editar perfil</a>
        Privacidade do perfil: {{ current_user.visibility }}
        Nome de usuário: {{ current_user.username }}
        Senha: ************
    </div>

    <div>
        <a href="#">Ver formações</a>
        <span>Nenhuma formação cadastrada.</span>
    </div>

    <div>
        <form action="{{ url_for('usuario.delete') }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <input type="hidden" name="user_id" value="{{ current_user.user_id }}">
            <input type="submit" value="Deletar Conta" class="btn btn-danger">
        </form>
    </div>

    <script>
        function selectSupervisor(id, fullName) {
            document.getElementById('supervisorInput').value = id;
            document.getElementById('selectedSupervisor').textContent = fullName;
        }
    </script>
{% endblock %}